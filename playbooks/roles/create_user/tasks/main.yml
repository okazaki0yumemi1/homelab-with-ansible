---
  - name: Create user m918 for opizero2
    user:
      name: m918
      groups: orangepi, tty, disk, dialout, sudo, audio, video, plugdev, games, users, systemd-journal, input, netdev, ssh, bluetooth
      append: yes
      password: "{{ ansible_sudo_pass }}"
    become: yes
    when: inventory_hostname == "opizero2"

  - name: Create user m918
    user:
      name: m918
      groups: m918
      append: yes
      password: "{{ ansible_sudo_pass }}"
    when: inventory_hostname != "opizero2"

  - name: Set up sudo for user m918 without password
    copy:
      dest: /etc/sudoers.d/m918
      content: "m918 ALL=(ALL) NOPASSWD: ALL"
      validate: "visudo -cf %s"
    become: yes